---
import { getCollection } from 'astro:content';

// Get categories for mobile menu
const categories = await getCollection('categories');
const sortedCategories = categories.sort((a, b) => a.data.order - b.data.order);

// Filter to preferred categories only
const preferredCategories = sortedCategories.filter(category => 
  ['hosting', 'tutorials'].includes(category.id)
);
---

<div id="mobile-menu-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[9999] opacity-0 invisible transition-all duration-300 ease-in-out">
	<div class="absolute top-0 left-0 w-80 h-full bg-white dark:bg-slate-900 border-r border-gray-200 dark:border-slate-700 transform -translate-x-full transition-transform duration-300 ease-in-out flex flex-col shadow-2xl overflow-y-auto">
		<!-- Header -->
		<div class="flex justify-between items-center p-6 border-b border-gray-200 dark:border-slate-700">
			<h3 class="text-lg font-semibold text-gray-900 dark:text-white">Navigation</h3>
			<button id="mobile-menu-close" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors duration-200" aria-label="Close menu">
				<svg class="w-6 h-6 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
				</svg>
			</button>
		</div>

		<!-- Navigation Links -->
		<nav class="flex-1 py-4">
			<a href="/" class="mobile-nav-link flex items-center gap-4 px-6 py-4 text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 border-l-3 border-transparent hover:border-blue-600 font-medium">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
				</svg>
				Home
			</a>
			<a href="/" class="mobile-nav-link flex items-center gap-4 px-6 py-4 text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 border-l-3 border-transparent hover:border-blue-600 font-medium">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
				</svg>
				All Posts
			</a>
			
			<!-- Category Links -->
			<div class="px-6 py-2">
				<h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">Categories</h4>
			</div>
			
			<a href="/?category=hosting" class="mobile-nav-link flex items-center gap-4 px-6 py-4 text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 border-l-3 border-transparent hover:border-blue-600 font-medium">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"></path>
				</svg>
				🌐 Web Hosting
			</a>
			
			<a href="/?category=laravel" class="mobile-nav-link flex items-center gap-4 px-6 py-4 text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 border-l-3 border-transparent hover:border-blue-600 font-medium">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
				</svg>
				🔴 Laravel
			</a>
			
			<a href="/?category=react" class="mobile-nav-link flex items-center gap-4 px-6 py-4 text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 border-l-3 border-transparent hover:border-blue-600 font-medium">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
				</svg>
				⚛️ React
			</a>
			
			<a href="/?category=vue" class="mobile-nav-link flex items-center gap-4 px-6 py-4 text-gray-700 dark:text-gray-300 hover:bg-blue-50 dark:hover:bg-slate-800 hover:text-blue-600 dark:hover:text-blue-400 transition-all duration-200 border-l-3 border-transparent hover:border-blue-600 font-medium">
				<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
				</svg>
				💚 Vue.js
			</a>
		</nav>

		<!-- Footer with Social Links -->
		<div class="p-6 border-t border-gray-200 dark:border-slate-700">
			<div class="space-y-3">

			</div>
		</div>
	</div>
</div>

<style>
	/* Custom styles for mobile menu active state using TailwindCSS */
	#mobile-menu-overlay.active {
		@apply opacity-100 visible;
	}

	#mobile-menu-overlay.active > div {
		@apply translate-x-0;
	}

	/* Active navigation link styling */
	.mobile-nav-link.active {
		@apply bg-blue-50 dark:bg-slate-800 text-blue-600 dark:text-blue-400 border-blue-600;
	}

	/* Animation for menu items */
	.mobile-nav-link,
	.mobile-social-link {
		@apply opacity-0 -translate-x-5;
		animation: slideInLeft 0.3s ease forwards;
	}

	.mobile-nav-link:nth-child(1) { animation-delay: 0.1s; }
	.mobile-nav-link:nth-child(2) { animation-delay: 0.2s; }
	.mobile-social-link:nth-child(1) { animation-delay: 0.3s; }
	.mobile-social-link:nth-child(2) { animation-delay: 0.4s; }

	@keyframes slideInLeft {
		to {
			@apply opacity-100 translate-x-0;
		}
	}
</style>

<script>
	/**
	 * Mobile Menu Functionality
	 * Handles opening, closing, and navigation for mobile menu
	 */
	document.addEventListener('DOMContentLoaded', function() {
		const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
		const mobileMenuClose = document.getElementById('mobile-menu-close');
		const hamburgerBtn = document.getElementById('hamburger-menu');
		const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

		// Open mobile menu
		function openMobileMenu() {
			if (mobileMenuOverlay) {
				mobileMenuOverlay.classList.add('active');
				document.body.style.overflow = 'hidden';
				document.body.style.position = 'fixed';
				document.body.style.width = '100%';
			}
		}

		// Close mobile menu
		function closeMobileMenu() {
			if (mobileMenuOverlay) {
				mobileMenuOverlay.classList.remove('active');
				document.body.style.overflow = '';
				document.body.style.position = '';
				document.body.style.width = '';
			}
		}

		// Event listeners with error handling
		if (hamburgerBtn) {
			hamburgerBtn.addEventListener('click', function(e) {
				e.preventDefault();
				e.stopPropagation();
				console.log('Hamburger clicked');
				openMobileMenu();
			});
		} else {
			console.error('Hamburger button not found');
		}

		if (mobileMenuClose) {
			mobileMenuClose.addEventListener('click', function(e) {
				e.preventDefault();
				e.stopPropagation();
				closeMobileMenu();
			});
		}

		// Close menu when clicking overlay
		if (mobileMenuOverlay) {
			mobileMenuOverlay.addEventListener('click', function(e) {
				if (e.target === mobileMenuOverlay) {
					closeMobileMenu();
				}
			});
		}

		// Close menu when clicking nav links
		mobileNavLinks.forEach(link => {
			link.addEventListener('click', closeMobileMenu);
		});

		// Close menu with Escape key
		document.addEventListener('keydown', function(e) {
			if (e.key === 'Escape' && mobileMenuOverlay.classList.contains('active')) {
				closeMobileMenu();
			}
		});

		// Set active link based on current page
		function setActiveLink() {
			const currentPath = window.location.pathname;
			mobileNavLinks.forEach(link => {
				link.classList.remove('active');
				if (link.getAttribute('href') === currentPath || 
					(currentPath === '/' && link.getAttribute('href') === '/') ||
					(currentPath === '/' && link.getAttribute('href') === '/')) {
					link.classList.add('active');
				}
			});
		}

		// Set active link on page load
		setActiveLink();
	});

	// Re-initialize on page navigation (for SPA-like behavior)
	document.addEventListener('astro:page-load', function() {
		const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
		const currentPath = window.location.pathname;
		
		mobileNavLinks.forEach(link => {
			link.classList.remove('active');
			if (link.getAttribute('href') === currentPath || 
				(currentPath === '/' && link.getAttribute('href') === '/') ||
				(currentPath === '/' && link.getAttribute('href') === '/')) {
				link.classList.add('active');
			}
		});
	});
</script>